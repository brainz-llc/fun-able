<% content_for :title, "Resultados - Que Prefieres" %>
<% content_for :hide_footer, true %>

<div class="min-h-screen relative overflow-hidden">
  <!-- Animated Background -->
  <div class="absolute inset-0 pointer-events-none">
    <div class="absolute top-0 left-0 -translate-x-1/2 w-64 h-64 md:w-[500px] md:h-[500px] bg-pink-500/15 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute top-1/3 right-0 translate-x-1/2 w-80 h-80 md:w-[500px] md:h-[500px] bg-cyan-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
    <div class="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 w-96 h-96 md:w-[600px] md:h-[600px] bg-purple-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 2s;"></div>
  </div>

  <div class="relative z-10 max-w-2xl mx-auto px-4 py-8">
    <!-- Header -->
    <div class="text-center mb-8">
      <div class="text-6xl mb-4">üèÜ</div>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-2">Juego Terminado!</h1>
      <p class="text-white/60">Resumen de la partida</p>
    </div>

    <!-- Winner -->
    <% winner = @game.leaderboard.first %>
    <% if winner %>
      <div class="mb-8 p-6 rounded-2xl text-center"
           style="background: linear-gradient(145deg, rgba(251, 191, 36, 0.1) 0%, rgba(251, 191, 36, 0.05) 100%);
                  border: 2px solid rgba(251, 191, 36, 0.3);
                  box-shadow: 0 0 40px rgba(251, 191, 36, 0.2);">
        <p class="text-yellow-400/70 text-sm uppercase tracking-wider mb-2">Ganador</p>
        <div class="w-20 h-20 mx-auto mb-3 rounded-full flex items-center justify-center text-2xl font-bold text-white"
             style="background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
                    box-shadow: 0 0 30px rgba(251, 191, 36, 0.5);">
          <%= winner.avatar_initials %>
        </div>
        <h2 class="text-2xl font-black text-white mb-2"><%= winner.display_name %></h2>
        <div class="flex items-center justify-center gap-4 text-sm">
          <span class="text-green-400">Solo <%= winner.drinks_taken %> bebidas!</span>
          <span class="text-cyan-400">Racha maxima: <%= winner.max_streak %></span>
        </div>
      </div>
    <% end %>

    <!-- Full Leaderboard -->
    <div class="bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10 p-4 mb-8">
      <h3 class="text-lg font-bold text-white mb-4">Resultados Finales</h3>
      <div class="space-y-3">
        <% @game.leaderboard.each_with_index do |player, idx| %>
          <div class="flex items-center justify-between py-3 px-4 rounded-xl <%= idx == 0 ? 'bg-yellow-500/10 border border-yellow-500/30' : 'bg-white/5' %>">
            <div class="flex items-center gap-3">
              <span class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold <%= idx == 0 ? 'bg-yellow-500 text-black' : idx == 1 ? 'bg-gray-400 text-black' : idx == 2 ? 'bg-orange-600 text-white' : 'bg-white/10 text-white/50' %>">
                <%= idx + 1 %>
              </span>
              <div class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold text-white"
                   style="background: linear-gradient(135deg, #ec4899 0%, #a855f7 100%);">
                <%= player.avatar_initials %>
              </div>
              <div>
                <span class="text-white font-medium"><%= player.display_name %></span>
                <% if player.id == @current_player&.id %>
                  <span class="text-xs text-purple-400 ml-1">(tu)</span>
                <% end %>
              </div>
            </div>
            <div class="text-right">
              <div class="text-lg font-bold <%= player.drinks_taken > 5 ? 'text-red-400' : player.drinks_taken > 2 ? 'text-yellow-400' : 'text-green-400' %>">
                <%= player.drinks_taken %> üç∫
              </div>
              <div class="text-xs text-white/50">
                Racha: <%= player.max_streak %> | Minoria: <%= player.times_in_minority %>x
              </div>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Stats -->
    <div class="grid grid-cols-2 gap-4 mb-8">
      <div class="p-4 rounded-xl bg-white/5 border border-white/10 text-center">
        <p class="text-white/50 text-xs uppercase tracking-wider mb-1">Total Rondas</p>
        <p class="text-2xl font-bold text-cyan-400"><%= @game.max_rounds %></p>
      </div>
      <div class="p-4 rounded-xl bg-white/5 border border-white/10 text-center">
        <p class="text-white/50 text-xs uppercase tracking-wider mb-1">Total Bebidas</p>
        <p class="text-2xl font-bold text-pink-400"><%= @game.would_you_rather_players.sum(:drinks_taken) %></p>
      </div>
    </div>

    <!-- Actions -->
    <div class="space-y-3">
      <%= link_to "Nueva Partida", new_would_you_rather_path, class: "block w-full py-4 rounded-xl font-bold text-white text-lg text-center transition-all hover:scale-[1.02]", style: "background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 50%, #06b6d4 100%); box-shadow: 0 0 20px rgba(236, 72, 153, 0.3);" %>
      <%= link_to "Volver al Inicio", would_you_rather_index_path, class: "block w-full py-3 rounded-xl font-bold text-white/60 text-center border border-white/20 hover:border-white/40 hover:text-white transition-all" %>
    </div>
  </div>
</div>
