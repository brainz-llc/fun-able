<% content_for :hide_footer, true %>
<%
  last_king_drawer = @game.drawn_cards.where(value: 'K').order(drawn_at: :desc).first&.drawn_by
%>

<div class="min-h-screen relative overflow-hidden flex items-center justify-center">
  <!-- Background -->
  <div class="absolute inset-0 pointer-events-none" style="clip-path: inset(0);">
    <div class="absolute top-0 left-0 -translate-x-1/2 w-64 h-64 md:w-[500px] md:h-[500px] bg-amber-500/20 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute bottom-0 right-0 translate-x-1/2 w-80 h-80 md:w-[500px] md:h-[500px] bg-pink-500/15 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
  </div>

  <div class="relative z-10 max-w-md mx-auto px-4 text-center">
    <!-- Crown Animation -->
    <div class="mb-8 animate-bounce">
      <div class="w-32 h-32 rounded-full flex items-center justify-center mx-auto"
           style="background: linear-gradient(145deg, rgba(251, 191, 36, 0.3) 0%, rgba(245, 158, 11, 0.2) 100%);
                  border: 3px solid rgba(251, 191, 36, 0.6);
                  box-shadow: 0 0 60px rgba(251, 191, 36, 0.5);">
        <span class="text-7xl">ğŸ‘‘</span>
      </div>
    </div>

    <!-- Title -->
    <h1 class="text-3xl md:text-4xl font-black text-white mb-4"
        style="text-shadow: 0 0 30px rgba(251, 191, 36, 0.5);">
      Partida Terminada!
    </h1>

    <!-- Cup filled message -->
    <div class="p-6 rounded-2xl mb-8"
         style="background: linear-gradient(145deg, rgba(251, 191, 36, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%);
                border: 2px solid rgba(251, 191, 36, 0.4);
                box-shadow: 0 10px 40px rgba(0,0,0,0.4);">
      <p class="text-xl text-amber-400 font-bold mb-2">La Copa del Rey esta llena!</p>
      <% if last_king_drawer %>
        <p class="text-white/80">
          <span class="font-bold text-white"><%= last_king_drawer.display_name %></span>
          saco el 4to Rey
        </p>
        <div class="mt-4 p-4 rounded-xl bg-black/30">
          <span class="text-4xl">ğŸº</span>
          <p class="text-amber-300 font-bold mt-2">Debe beber la Copa del Rey!</p>
        </div>
      <% end %>
    </div>

    <!-- Stats -->
    <div class="grid grid-cols-2 gap-4 mb-8">
      <div class="p-4 rounded-xl bg-white/5 border border-white/10">
        <span class="text-2xl block mb-1">ğŸƒ</span>
        <span class="text-2xl font-bold text-white"><%= 52 - @game.cards_remaining %></span>
        <span class="text-white/50 text-sm block">Cartas sacadas</span>
      </div>
      <div class="p-4 rounded-xl bg-white/5 border border-white/10">
        <span class="text-2xl block mb-1">ğŸ‘¥</span>
        <span class="text-2xl font-bold text-white"><%= @game.player_count %></span>
        <span class="text-white/50 text-sm block">Jugadores</span>
      </div>
    </div>

    <!-- Actions -->
    <div class="space-y-3">
      <%= link_to kings_cup_new_path, class: "block w-full py-4 rounded-xl font-bold text-black text-lg transition-all duration-300 active:scale-[0.98]",
                  style: "background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%); box-shadow: 0 0 30px rgba(251, 191, 36, 0.4);" do %>
        Nueva Partida
      <% end %>

      <%= link_to kings_cup_path, class: "block w-full py-4 rounded-xl font-medium text-white bg-white/10 hover:bg-white/20 transition-all" do %>
        Volver al Menu
      <% end %>
    </div>
  </div>
</div>
