<% content_for :hide_footer, true %>
<%
  is_reader = current_nhie_player&.current_reader?
  can_advance = nhie_game_host? || is_reader
%>

<div class="min-h-screen relative overflow-hidden"
     data-controller="never-have-i-ever"
     data-never-have-i-ever-game-id-value="<%= current_nhie_game.id %>"
     data-never-have-i-ever-player-id-value="<%= current_nhie_player&.id %>"
     data-never-have-i-ever-is-reader-value="<%= is_reader %>"
     data-never-have-i-ever-is-host-value="<%= nhie_game_host? %>">

  <!-- Animated Background -->
  <div class="absolute inset-0 pointer-events-none" style="clip-path: inset(0);">
    <div class="absolute top-0 left-0 -translate-x-1/2 w-64 h-64 md:w-[500px] md:h-[500px] bg-purple-500/15 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute top-1/3 right-0 translate-x-1/2 w-80 h-80 md:w-[500px] md:h-[500px] bg-pink-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
    <div class="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 w-96 h-96 md:w-[600px] md:h-[600px] bg-cyan-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 2s;"></div>
  </div>

  <!-- Top Bar -->
  <div class="relative z-20 px-4 py-3 bg-black/60 backdrop-blur-xl border-b border-white/5">
    <div class="flex items-center justify-between">
      <!-- Left: Game Title -->
      <div class="flex items-center gap-2">
        <h1 class="font-black text-lg tracking-tight">
          <span style="color: #a855f7; text-shadow: 0 0 10px rgba(168, 85, 247, 0.4);">Yo Nunca</span>
        </h1>
      </div>

      <!-- Center: Category Badge -->
      <div class="absolute left-1/2 -translate-x-1/2">
        <div class="px-3 py-1 rounded-full text-xs font-bold"
             style="<%= case current_nhie_game.category
                        when 'tame' then 'background: rgba(34, 197, 94, 0.2); color: #22c55e; border: 1px solid rgba(34, 197, 94, 0.3);'
                        when 'spicy' then 'background: rgba(251, 146, 60, 0.2); color: #fb923c; border: 1px solid rgba(251, 146, 60, 0.3);'
                        when 'extreme' then 'background: rgba(239, 68, 68, 0.2); color: #ef4444; border: 1px solid rgba(239, 68, 68, 0.3);'
                        end %>">
          <%= { 'tame' => 'Suave', 'spicy' => 'Picante', 'extreme' => 'Extremo' }[current_nhie_game.category] %>
        </div>
      </div>

      <!-- Right: Points + Menu -->
      <div class="flex items-center gap-2">
        <!-- Points Badge -->
        <div class="flex items-center gap-1.5 px-3 py-1.5 rounded-lg"
             style="background: linear-gradient(135deg, rgba(236, 72, 153, 0.15) 0%, rgba(168, 85, 247, 0.1) 100%);
                    border: 1px solid rgba(236, 72, 153, 0.2);">
          <span class="text-[10px] uppercase tracking-wider text-pink-400/70">Vidas</span>
          <span class="text-lg font-black text-white transition-all duration-300"
                data-never-have-i-ever-target="pointsDisplay"
                style="text-shadow: 0 0 10px rgba(236, 72, 153, 0.4);">
            <%= current_nhie_player&.points || 0 %>
          </span>
        </div>

        <!-- Menu Button -->
        <button type="button"
                class="p-2 rounded-lg text-white/50 hover:text-white hover:bg-white/10 transition-all"
                data-action="click->never-have-i-ever#toggleScoreboard">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="relative z-10 max-w-4xl mx-auto px-4 py-8">

    <!-- Reader Indicator -->
    <div class="text-center mb-6">
      <% reader = current_nhie_game.current_reader %>
      <% if reader %>
        <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full"
             style="background: <%= is_reader ? 'linear-gradient(135deg, rgba(168, 85, 247, 0.2) 0%, rgba(236, 72, 153, 0.15) 100%)' : 'rgba(255, 255, 255, 0.05)' %>;
                    border: 1px solid <%= is_reader ? 'rgba(168, 85, 247, 0.4)' : 'rgba(255, 255, 255, 0.1)' %>;">
          <% if is_reader %>
            <span class="text-lg">&#128483;</span>
            <span class="text-purple-400 font-bold text-sm">Tu turno de leer!</span>
          <% else %>
            <span class="text-sm text-white/60">Lee: <span class="text-purple-400 font-bold"><%= reader.display_name %></span></span>
          <% end %>
        </div>
      <% end %>
    </div>

    <!-- Current Card -->
    <div class="flex justify-center mb-8" data-never-have-i-ever-target="card">
      <% if current_nhie_game.current_card %>
        <div class="w-full max-w-md p-6 rounded-2xl transition-all duration-500"
             style="background: linear-gradient(145deg, #0a0a0a 0%, #1a1a1a 100%);
                    border: 2px solid rgba(168, 85, 247, 0.4);
                    box-shadow: 0 0 40px rgba(168, 85, 247, 0.2), 0 20px 40px rgba(0,0,0,0.5);">

          <div class="text-center mb-4">
            <span class="text-4xl">&#127922;</span>
          </div>

          <p class="text-xl md:text-2xl text-white text-center leading-relaxed font-medium"
             data-never-have-i-ever-target="cardContent">
            <%= current_nhie_game.current_card.content %>
          </p>

          <div class="mt-6 flex items-center justify-center gap-2 text-xs text-white/30">
            <span style="color: #a855f7;">Yo Nunca Nunca</span>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row gap-4 justify-center mb-8">
      <% unless current_nhie_player&.drank_this_round? %>
        <button type="button"
                class="flex-1 sm:flex-none px-8 py-4 rounded-xl font-bold text-lg text-white transition-all duration-300 hover:scale-[1.02] active:scale-[0.98]"
                style="background: linear-gradient(135deg, #ec4899 0%, #db2777 100%);
                       box-shadow: 0 0 30px rgba(236, 72, 153, 0.4);"
                data-action="click->never-have-i-ever#drink"
                data-url="<%= drink_never_have_i_ever_game_actions_path(current_nhie_game) %>"
                data-never-have-i-ever-target="drinkButton">
          <span class="text-xl mr-2">&#127866;</span>
          Lo he hecho... Bebo!
        </button>
      <% else %>
        <div class="flex-1 sm:flex-none px-8 py-4 rounded-xl font-bold text-lg text-white/50 text-center"
             style="background: rgba(60, 60, 60, 0.3); border: 1px solid rgba(255, 255, 255, 0.1);">
          <span class="text-xl mr-2">&#10003;</span>
          Ya bebiste esta ronda
        </div>
      <% end %>

      <% if can_advance %>
        <button type="button"
                class="flex-1 sm:flex-none px-8 py-4 rounded-xl font-bold text-lg text-white transition-all duration-300 hover:scale-[1.02] active:scale-[0.98]"
                style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%);
                       box-shadow: 0 0 20px rgba(6, 182, 212, 0.3);"
                data-action="click->never-have-i-ever#nextCard"
                data-url="<%= next_card_never_have_i_ever_game_actions_path(current_nhie_game) %>"
                data-never-have-i-ever-target="nextButton">
          Siguiente Carta
          <span class="ml-2">&rarr;</span>
        </button>
      <% end %>
    </div>

    <!-- Players Status -->
    <div class="p-4 rounded-xl"
         style="background: rgba(10, 10, 15, 0.6); border: 1px solid rgba(255, 255, 255, 0.05);">
      <h3 class="text-sm font-medium text-white/60 mb-3">Jugadores esta ronda</h3>
      <div class="flex flex-wrap gap-3" data-never-have-i-ever-target="playersList">
        <% current_nhie_game.leaderboard.each do |player| %>
          <div class="flex items-center gap-2 px-3 py-2 rounded-lg transition-all duration-300"
               data-player-id="<%= player.id %>"
               style="background: rgba(20, 20, 25, 0.8);
                      border: 1px solid <%= player.drank_this_round? ? 'rgba(236, 72, 153, 0.4)' : (player.current_reader? ? 'rgba(168, 85, 247, 0.4)' : 'rgba(255, 255, 255, 0.1)') %>;">
            <div class="w-7 h-7 rounded-full flex items-center justify-center text-[10px] font-bold text-white"
                 style="background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);
                        <%= 'opacity: 0.3;' if player.eliminated? %>">
              <%= player.avatar_initials %>
            </div>
            <span class="text-xs text-white/80 <%= 'line-through opacity-40' if player.eliminated? %>">
              <%= player.display_name %>
            </span>
            <% if player.current_reader? && !player.eliminated? %>
              <span class="text-xs">&#128483;</span>
            <% end %>
            <% if player.drank_this_round? %>
              <span class="text-xs">&#127866;</span>
            <% end %>
            <span class="text-sm font-bold transition-all duration-300 <%= player.eliminated? ? 'text-red-400' : 'text-cyan-400' %>"
                  data-points>
              <%= player.points %>
            </span>
          </div>
        <% end %>
      </div>
    </div>

  </div>

  <!-- Mobile Scoreboard Overlay -->
  <div class="fixed inset-0 z-50 pointer-events-none" data-never-have-i-ever-target="mobileScoreboardOverlay">
    <div class="absolute inset-0 bg-black/70 opacity-0 transition-opacity duration-300 pointer-events-none"
         data-never-have-i-ever-target="mobileScoreboardBackdrop"
         data-action="click->never-have-i-ever#toggleScoreboard"></div>
    <div class="absolute top-0 right-0 h-full w-4/5 max-w-sm bg-black/95 backdrop-blur-md transform translate-x-full transition-transform duration-300 border-l border-white/10"
         data-never-have-i-ever-target="mobileScoreboardPanel">
      <div class="p-4 border-b border-white/10 flex items-center justify-between">
        <h3 class="font-bold text-white">Puntuacion</h3>
        <button type="button" class="p-2 text-white/50 hover:text-white" data-action="click->never-have-i-ever#toggleScoreboard">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="p-4">
        <% current_nhie_game.leaderboard.each do |player| %>
          <div class="flex items-center justify-between py-3 border-b border-white/10 last:border-0 <%= 'opacity-40' if player.eliminated? %>">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 rounded-full flex items-center justify-center text-sm font-bold text-white"
                   style="background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);">
                <%= player.avatar_initials %>
              </div>
              <span class="font-medium text-white <%= 'line-through' if player.eliminated? %>">
                <%= player.display_name %>
                <% if player.current_reader? && !player.eliminated? %>
                  <span class="text-purple-400 text-xs block">&#128483; Leyendo</span>
                <% end %>
                <% if player.eliminated? %>
                  <span class="text-red-400 text-xs block">Eliminado</span>
                <% end %>
              </span>
            </div>
            <span class="text-2xl font-bold <%= player.eliminated? ? 'text-red-400' : 'text-cyan-400' %>">
              <%= player.points %>
            </span>
          </div>
        <% end %>
        <div class="mt-4 pt-4 border-t border-white/10">
          <%= button_to "Abandonar",
              leave_never_have_i_ever_game_actions_path(current_nhie_game),
              method: :post,
              class: "w-full py-3 rounded-xl text-sm font-bold text-red-400 bg-red-500/10 border border-red-500/30",
              data: { turbo_confirm: "Abandonar la partida?" } %>
        </div>
      </div>
    </div>
  </div>

  <!-- Victory Modal -->
  <div class="fixed inset-0 z-50 flex items-center justify-center p-4"
       style="display: none; background: rgba(0, 0, 0, 0.95);"
       data-never-have-i-ever-target="victoryModal">
    <div class="w-full max-w-sm p-6 rounded-2xl text-center"
         style="background: linear-gradient(145deg, rgba(168, 85, 247, 0.1) 0%, rgba(0,0,0,0.9) 100%);
                border: 2px solid rgba(168, 85, 247, 0.4);">
      <div class="text-6xl mb-4">&#127942;</div>
      <div class="text-2xl font-bold text-white mb-4" data-never-have-i-ever-target="victoryTitle"></div>
      <button type="button"
              class="w-full py-3 rounded-xl font-bold text-white transition-all"
              style="background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%);"
              data-action="click->never-have-i-ever#closeVictory">
        Continuar
      </button>
    </div>
  </div>
</div>
