<% content_for :hide_footer, true %>
<% winner = current_nhie_game.winner %>

<div class="min-h-screen relative overflow-hidden flex items-center justify-center">
  <!-- Animated Background -->
  <div class="absolute inset-0 pointer-events-none" style="clip-path: inset(0);">
    <div class="absolute top-1/4 left-0 -translate-x-1/2 w-64 h-64 md:w-[400px] md:h-[400px] bg-purple-500/20 rounded-full blur-3xl animate-pulse"></div>
    <div class="absolute top-1/3 right-0 translate-x-1/2 w-80 h-80 md:w-[500px] md:h-[500px] bg-pink-500/15 rounded-full blur-3xl animate-pulse" style="animation-delay: 1s;"></div>
    <div class="absolute bottom-1/4 left-1/2 -translate-x-1/2 w-48 h-48 md:w-[300px] md:h-[300px] bg-yellow-500/10 rounded-full blur-3xl animate-pulse" style="animation-delay: 2s;"></div>
  </div>

  <div class="relative z-10 w-full max-w-lg mx-auto px-4 py-12 text-center">
    <!-- Trophy -->
    <div class="inline-flex items-center justify-center w-24 h-24 rounded-full mb-6"
         style="background: linear-gradient(145deg, #fbbf24 0%, #f59e0b 100%);
                box-shadow: 0 0 60px rgba(251, 191, 36, 0.5);">
      <span class="text-5xl">&#127942;</span>
    </div>

    <!-- Winner -->
    <% if winner %>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-2">
        <%= winner.display_name %> Gana!
      </h1>
      <p class="text-lg text-purple-400 mb-8">
        Con <%= winner.points %> <%= winner.points == 1 ? 'punto' : 'puntos' %> restantes
      </p>
    <% else %>
      <h1 class="text-3xl md:text-4xl font-black text-white mb-2">
        Partida Terminada
      </h1>
      <p class="text-lg text-white/60 mb-8">Todos fueron eliminados!</p>
    <% end %>

    <!-- Final Leaderboard -->
    <div class="p-5 rounded-2xl mb-8"
         style="background: rgba(10, 10, 15, 0.8); border: 1px solid rgba(168, 85, 247, 0.2);">
      <h2 class="text-sm font-medium text-white/60 mb-4">Resultados finales</h2>
      <% current_nhie_game.leaderboard.each_with_index do |player, idx| %>
        <div class="flex items-center justify-between py-3 <%= 'border-t border-white/10' unless idx == 0 %>">
          <div class="flex items-center gap-3">
            <span class="w-6 text-center font-bold <%= idx == 0 ? 'text-yellow-400' : 'text-white/40' %>">
              <%= idx == 0 ? '&#127942;' : "##{idx + 1}" %>
            </span>
            <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold text-white"
                 style="background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);">
              <%= player.avatar_initials %>
            </div>
            <span class="font-medium text-white"><%= player.display_name %></span>
          </div>
          <span class="text-xl font-bold <%= player.points > 0 ? 'text-cyan-400' : 'text-red-400' %>">
            <%= player.points %>
          </span>
        </div>
      <% end %>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <%= link_to never_have_i_ever_path,
          class: "px-8 py-4 rounded-xl font-bold text-lg text-white transition-all duration-300 hover:scale-[1.02] active:scale-[0.98]",
          style: "background: linear-gradient(135deg, #a855f7 0%, #7c3aed 100%); box-shadow: 0 0 30px rgba(168, 85, 247, 0.4);" do %>
        Nueva Partida
      <% end %>

      <%= link_to root_path,
          class: "px-8 py-4 rounded-xl font-bold text-lg text-white/60 hover:text-white transition-all duration-300 border border-white/20 hover:border-white/40" do %>
        Volver al Inicio
      <% end %>
    </div>
  </div>
</div>

<script>
  // Fire confetti on page load
  if (typeof window.confetti === "function") {
    setTimeout(() => {
      window.confetti({
        particleCount: 100,
        spread: 70,
        origin: { y: 0.6 }
      })
    }, 500)
  }
</script>
