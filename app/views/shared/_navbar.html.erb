<nav class="fixed top-0 left-0 right-0 z-40 transition-all duration-300"
     style="padding-top: env(safe-area-inset-top, 0px);"
     data-controller="navbar"
     data-navbar-transparent-class="bg-transparent"
     data-navbar-solid-class="bg-bg-darker/95 backdrop-blur-md border-b border-neon-purple/20">
  <div class="container mx-auto px-4">
    <div class="flex items-center justify-between h-16">

      <%# Logo - Neon Sign %>
      <%= link_to root_path, class: "flex items-center gap-2 group" do %>
        <span class="text-xl font-bold neon-logo">
          <span class="neon-logo-pink">Fun</span><span class="neon-logo-dash">-</span><span class="neon-logo-pink neon-logo-flicker-delayed">able</span>
        </span>
      <% end %>

      <%# Desktop Navigation %>
      <div class="hidden lg:flex items-center gap-6">
        <%= link_to t('nav.browse_decks'), decks_path, class: "text-sm font-medium text-white/70 hover:text-cyan-400 transition-colors" %>
        <% if logged_in? %>
          <%= link_to t('nav.my_decks'), my_decks_decks_path, class: "text-sm font-medium text-white/70 hover:text-purple-400 transition-colors" %>
        <% end %>
      </div>

      <%# Right side %>
      <div class="flex items-center gap-3">
        <% if logged_in? %>
          <%= link_to new_game_path, class: "hidden lg:flex neon-btn neon-btn-pink text-sm px-5 py-2" do %>
            <%= t('nav.create_game') %>
          <% end %>

          <%# User menu %>
          <div class="relative" data-controller="dropdown">
            <button type="button" class="flex items-center gap-2 px-2 py-1.5 rounded-lg hover:bg-white/10 transition" data-action="click->dropdown#toggle">
              <div class="w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold"
                   style="background: linear-gradient(135deg, #ec4899 0%, #a855f7 100%);">
                <%= current_user.avatar_initials %>
              </div>
              <span class="hidden lg:block text-sm text-white/80 max-w-24 truncate"><%= current_user.display_name %></span>
            </button>
            <div class="absolute right-0 mt-2 w-56 rounded-xl overflow-hidden hidden"
                 style="background: rgba(15, 15, 20, 0.95); border: 1px solid rgba(168, 85, 247, 0.3); box-shadow: 0 10px 40px rgba(0,0,0,0.5), 0 0 20px rgba(168, 85, 247, 0.1);"
                 data-dropdown-target="menu">
              <div class="px-4 py-3 border-b border-white/10">
                <div class="font-medium text-white"><%= current_user.display_name %></div>
                <% if guest_user? %>
                  <div class="text-xs text-pink-400 mt-0.5"><%= t('user.guest') %></div>
                <% else %>
                  <div class="text-xs text-white/50 mt-0.5 truncate"><%= current_user.email %></div>
                <% end %>
              </div>
              <% if guest_user? %>
                <%= link_to new_registration_path, class: "flex items-center gap-2 px-4 py-3 text-sm text-pink-400 hover:bg-pink-500/10 transition" do %>
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                  </svg>
                  <%= t('user.upgrade_account') %>
                <% end %>
              <% end %>
              <%= link_to my_decks_decks_path, class: "flex items-center gap-2 px-4 py-3 text-sm text-white/70 hover:text-white hover:bg-white/5 transition" do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"></path>
                </svg>
                <%= t('nav.my_decks') %>
              <% end %>
              <div class="border-t border-white/10"></div>
              <%= button_to session_path, method: :delete, class: "flex items-center gap-2 w-full px-4 py-3 text-sm text-red-400 hover:bg-red-500/10 transition" do %>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                </svg>
                <%= t('nav.logout') %>
              <% end %>
            </div>
          </div>
        <% else %>
          <%= link_to t('nav.login'), new_session_path, class: "hidden lg:block text-sm text-white/70 hover:text-white transition-colors" %>
          <%= button_to t('home.play_as_guest'), create_guest_session_path, class: "neon-btn neon-btn-pink text-sm px-5 py-2" %>
        <% end %>

        <%# Mobile menu button %>
        <button type="button" class="lg:hidden p-2 rounded-lg text-white/70 hover:text-white hover:bg-white/10 transition"
                data-action="click->mobile-menu#open">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>
</nav>

<%# Spacer for fixed navbar %>
<div class="h-16" style="padding-top: env(safe-area-inset-top, 0px);"></div>
